<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CVCC Course Schedule</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --cvcc-primary: #BA0C2F; /* Red Hawk Red */
      --cvcc-secondary: #505759; /* CVCC Classic Grey */
      --cvcc-light-grey-bg: #f8f8f8; /* Very light grey for alternating rows */
      --cvcc-red-text: #A6192E; /* CVCC Classic Red, used for general red text */
    }
    body {
      background-color: #eaeaea;
      color: #333;
      font-family: 'Montserrat', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    /* Header area for logo and title */
    .app-header {
      display: flex;
      justify-content: space-between; /* Pushes items to opposite ends */
      align-items: flex-end; /* ALIGNS ITEMS TO THE BOTTOM */
      margin-bottom: 1.5rem; /* Space below header */
    }
    h1 {
      color: var(--cvcc-primary);
      font-weight: 700;
      margin-bottom: 0; /* Remove default bottom margin */
    }
    .logo {
      max-width: 200px; /* Reduced logo size */
      height: auto;
    }
    .filter-bar {
      margin-bottom: 1rem;
      background: white;
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 1rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      /* No specific width, let Bootstrap's col-md-10 handle it within the row */
    }
    .table-wrapper {
      max-height: 70vh;
      overflow-y: auto;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      /* No specific width, let Bootstrap's default table behavior handle it */
    }
    .table {
      width: 100%; /* Make the table itself full width of its parent */
      margin-bottom: 0; /* Remove default bottom margin */
    }
    thead th {
      position: sticky;
      top: 0;
      background-color: var(--cvcc-primary) !important;
      color: white !important;
      z-index: 2;
      font-weight: 600;
    }
    th.section-col { min-width: 140px; }
    td.notes-col {
      max-width: 400px;
      white-space: normal;
      word-wrap: break-word;
    }
    /* Alternating row colors - CORRECTED */
    .table > tbody > tr:nth-child(odd) > td {
      background-color: var(--cvcc-light-grey-bg) !important; /* Use the new variable */
    }

    .table > tbody > tr:nth-child(even) > td {
      background-color: #ffffff !important;
    }

    /* Text color for links */
    a {
      color: var(--cvcc-red-text);
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div id="app" class="container py-4">
    <div class="app-header">
      <h1>Course Schedule</h1>
      <img src="CVCC_Primary_Horizontal.png" alt="CVCC Logo" class="logo">
    </div>

    <div class="row filter-bar">
      <div class="col-md-3">
        <label class="form-label">Term</label>
        <select v-model="selectedTerm" @change="loadCourses" class="form-select">
          <option v-for="(file, label) in termFiles" :value="file">{{ label }}</option>
        </select>
      </div>
      <div class="col-md-3">
        <label class="form-label">Delivery Method</label>
        <select v-model="selectedDelivery" class="form-select">
          <option value="">All</option>
          <option value="Online">Online</option>
          <option value="Hybrid">Hybrid</option>
          <option value="Traditional">Traditional</option>
        </select>
      </div>
      <div class="col-md-4">
        <label class="form-label">Search</label>
        <input v-model="searchQuery" class="form-control" placeholder="Search title or section">
      </div>
    </div>

    <div v-if="loading" class="alert alert-info">Loading courses...</div>
    <div v-else-if="filteredCourses.length === 0 && !loading" class="alert alert-warning">No courses found matching your criteria.</div>

    <div class="table-wrapper">
      <table class="table table-bordered">
        <thead>
          <tr>
            <th class="section-col">Section</th>
            <th>Title</th>
            <th>Credits</th>
            <th>Delivery</th>
            <th>Location</th>
            <th>Start</th>
            <th>End</th>
            <th>Seats Available</th>
            <th>Instructor</th>
            <th>Status</th>
            <th>Description/Notes</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="course in filteredCourses" :key="course.secsynonym">
            <td class="section-col">{{ course.secname }}</td>
            <td>{{ course.secshorttitle }}</td>
            <td>{{ course.secmincred }}</td>
            <td>{{ getDeliveryCategoryFromSection(course.secname) }}</td>
            <td>{{ (course.xsecRoom.length > 0 ? course.xsecRoom.join(', ') : '') + ' ' + (course.secBldgmv.length > 0 ? course.secBldgmv.join(', ') : '') }}</td>
            <td>{{ course.secstartdate }}</td>
            <td>{{ course.secenddate }}</td>
            <td>{{ course.xcrssecseatavail.length > 0 ? course.xcrssecseatavail.join(', ') : 'N/A' }}</td>
            <td>{{ formatInstructor(course.xcrssecfacultyxname) }}</td>
            <td>{{ course.status }}</td>
            <td class="notes-col" v-html="formatNotes(course.secprintedcomments)"></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          courses: [],
          selectedDelivery: '',
          searchQuery: '',
          selectedTerm: '2025summer.json',
          termFiles: {
            'Summer 2025': '2025summer.json',
            'Fall 2025': '2025faintercession.json'
          },
          loading: false
        }
      },
      computed: {
        filteredCourses() {
          return this.courses.filter(c => {
            const deliveryCategory = this.getDeliveryCategoryFromSection(c.secname);
            const matchesDelivery = !this.selectedDelivery || this.selectedDelivery === deliveryCategory;
            const search = this.searchQuery.toLowerCase();
            const matchesSearch = !search || c.secname.toLowerCase().includes(search) || c.secshorttitle.toLowerCase().includes(search);
            return matchesDelivery && matchesSearch;
          });
        }
      },
      methods: {
        loadCourses() {
          this.loading = true;
          this.courses = [];
          fetch(this.selectedTerm)
            .then(res => {
              if (!res.ok) {
                throw new Error(`HTTP error! status: ${res.status}`);
              }
              return res.json();
            })
            .then(data => {
              this.courses = data;
              this.selectedDelivery = '';
              this.searchQuery = '';
            })
            .catch(error => {
              console.error('Error loading courses:', error);
              alert('Failed to load courses. Please try again later.');
            })
            .finally(() => {
              this.loading = false;
            });
        },
        formatInstructor(names) {
          if (!names || names.length === 0) return 'N/A';
          return names.map(name => {
            const parts = name.split(',').map(p => p.trim());
            // Ensure proper "Last, First" format if parts exist
            if (parts.length >= 2) {
                return `${parts[0]}, ${parts.slice(1).join(' ')}`;
            }
            return name;
          }).join('; ');
        },
        formatNotes(notes) {
          if (!notes || notes.length === 0) return '';
          const text = notes.join(' ');
          return text.replace(/(https?:\/\/\S+|www\.\S+)/gi, match => {
            const url = match.startsWith('http') ? match : `https://${match}`;
            return `<a href="${url}" target="_blank" rel="noopener">${match}</a>`;
          });
        },
        getDeliveryCategoryFromSection(sectionName) {
          if (!sectionName) return '';
          const match = sectionName.match(/-(\d{3,})$/);
          if (!match) return '';
          const num = parseInt(match?.[1]);
          if (isNaN(num)) return ''; // Handle cases where parseInt might fail
          if (num >= 800 && num <= 829) return 'Online';
          if (num >= 830 && num <= 874) return 'Hybrid';
          return 'Traditional';
        }
      },
      mounted() {
        this.loadCourses();
      }
    }).mount('#app');
  </script>
</body>
</html>